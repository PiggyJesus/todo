name: ci

on: [push]

jobs:
    main:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v3
            - uses: subosito/flutter-action@v2
              with:
                channel: 'stable'

            - name: Getting dependencies
              run: flutter pub get

            - name: Checking code format
              run: dart format --set-exit-if-changed lib/

            - name: Analyzing
              run: flutter analyze --no-fatal-infos

            - name: Testing local unit
              run: flutter test test/unit_tests/local_unit_test.dart

            - name: Testing task repository impl
              run: flutter test test/unit_tests/task_repository_impl_test.dart
              
            - name: Build
              run: flutter build apk -t lib/main_prod.dart --flavor production